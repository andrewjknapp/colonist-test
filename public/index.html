<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<link rel="stylesheet" href="style.css">
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		
		const sharedPlayerAttributes = {
			width  : 20,
			height : 100,
			speed  : 15,
			direction : 0,
		}
		
		app.onInit = function(){
			const canvas = document.getElementById("canvas");
			canvas.width = window.innerWidth;
			this.width = window.innerWidth;
			canvas.height = window.innerHeight;
			this.height = window.innerHeight;
		
			// Create Nodes for Player1, Player2, and Ball
			this.nodes.push({
				id : "player1",
				x  : 100,
				y  : (window.innerHeight / 2) - 50,
				color : "red",
				...sharedPlayerAttributes,
			})

			this.nodes.push({
				id : "player2",
				x  : window.innerWidth - 120,
				y  : (window.innerHeight / 2) - 50,
				color: "green",
				...sharedPlayerAttributes,
			})

			this.nodes.push({
				id : "ball",
				x  : (window.innerWidth / 2) - 10,
				y  : (window.innerHeight / 2) - 10,
				color  : "blue",
				width  : 20,
				height : 20,
				speed  : 5,
				dy : (Math.random() * 5) - 2.5,   // Initial y velocity between -2.5 and 2.5
				dx : ((Math.random() * 5) - 2.5), // Initial x velocity between -2.5 and 2.5 
			})

			// Add listeners to check for button presses
			// Will change position of player by adding 
			// their speed * direction to player y value
			// in onUpdate;
			document.addEventListener("keydown", (e) => {
				
				switch (e.key) {
					case 'w':
						this.getNode('player1').direction = -1;
						break;
					case 's':
						this.getNode('player1').direction = 1;
						break;
					case 'ArrowUp':
						this.getNode('player2').direction = -1;
						break;
					case 'ArrowDown':
						this.getNode('player2').direction = 1;
						break;
				}
			})

			document.addEventListener("keyup", (e) => {
				switch (e.key) {
					case 'w':
					case 's':
						this.getNode('player1').direction = 0;
						break;
					case 'ArrowUp':
					case 'ArrowDown':
						this.getNode('player2').direction = 0;
				}
			})
		};

		let player1;
		let player2;

		app.onUpdate = function(time){

			handlePlayerMovement(this.getNode('player1'));
			handlePlayerMovement(this.getNode('player2'));
		};

		const handlePlayerMovement = (player) => {
				// If the player is within the canvas allow to move *OR*
			if (player.y > 0 && player.y < window.innerHeight - player.height ||
				// If player is at top boundary, prevent from going upward *OR*
				player.y === 0 && player.direction != -1 ||
				// If player is at bottom boundary, prevent from going downward
				player.y === window.innerHeight - player.height && player.direction != 1) {

				player.y += player.direction * player.speed;
			}
			// If the player is above the top, set y to top.
			else if (player.y < 0) {
				player.y = 0;
			}
			// If the player is below the bottom, set y to bottom.
			else if (player.y > window.innerHeight - player.height) {
				player.y = window.innerHeight - player.height;
			}
		}
	</script>
</body>
</html>